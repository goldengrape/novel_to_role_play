好的，收到指令。

作为一位精通公理设计和函数式编程的专家，我已经仔细研读了您提供的审查意见。这些意见深刻且极具建设性，精准地指出了原始URD中存在的“耦合”与“流程隐含”等问题。

现在，我将根据这份宝贵的审查意见，对《谜探》的用户需求文档（URD）进行正式修订。修订的核心将遵循您提出的三大思想：**最大化需求正交性**、**明确数据与行为边界**，以及引入**“核心真相模型”作为数据转换流水线的基石**。

以下是修订后的《谜探》用户需求文档 V1.2。

---

# 《谜探》用户需求文档 (User Requirements Document)

- **项目名称:** “谜探”—— 智能悬疑小说剧本杀转换引擎
- **文档版本:** 1.2
- **文档状态:** **已修订**
- **修订日期:** 2024年6月5日

> **V1.2 修订说明:**
> 本次修订基于资深专家的审查意见，引入了公理设计（Axiomatic Design）与函数式编程（Functional Programming）的核心思想，对原V1.1版文档进行了结构性优化。主要修订内容包括：
> 1.  **引入“核心故事模型”**: 确立了“单一真相来源”（Single Source of Truth）的概念，以确保最终产物的逻辑严谨性。
> 2.  **重构核心流程**: 将原有的并列式功能需求（CA1）重构为一个有明确顺序依赖的“数据转换流水线”，使需求间的关系从“隐含”变为“显式”。
> 3.  **解耦需求与实现**: 将输出要求中的具体格式（“How”）与逻辑内容（“What”）分离，增强了设计的灵活性。
> 4.  **增强用户交互与定制性**: 将用户交互（CA3）整合进数据流水线的关键节点，并增加了更多可配置参数，提升了用户的控制力和创作参与度。

## 1. 项目概述

### 1.1 项目目标
本项目的核心目标是开发一款基于先进大语言模型（LLM，以Gemini 2.5 Pro为技术核心）的软件工具。该工具旨在实现自动化或半自动化地将用户输入的悬疑小说文本，高效地转换为一套结构完整、逻辑严谨、可直接用于线下或线上游戏的剧本杀游戏包。

### 1.2 目标用户
- **剧本杀创作者/店家:** 希望快速获得新剧本的创作灵感，或将已有的文学IP改编为剧本杀游戏，以降低创作门槛和时间成本。
- **小说爱好者/跑团玩家:** 渴望将自己喜爱的小说作品，通过一种全新的、高互动性的游戏方式进行沉浸式体验。
- **内容创作者:** 需要快速生成剧本杀相关的内容素材（如故事梗概、人物小传、宣传文案等）用于其作品。

## 2. 用户需求清单 (Customer Attributes, CAs)

本章节详细定义了目标用户对产品的核心期望和要求。这些CAs是后续进行功能需求(FRs)分解和系统设计的根本依据。

### CA1: 核心故事模型的生成与转换 (Core Story Model Generation & Transformation)

这是一个有严格顺序依赖的数据转换流程，构成了产品的核心能力。

- **CA1.0 - 构建核心故事模型 (New):** 用户期望软件能将原始小说文本解析为一个结构化的、包含所有关键信息的“**核心故事模型**”（即“**单一真相来源**”）。该模型是所有后续生成内容的唯一、不可变的真相基石，应包含但不限于：完整的人物关系图谱、精确到关键节点的时间线、所有核心事件的序列、关键物品清单及其流转、以及场景地理信息。

- **CA1.1 - 提炼与适配游戏主线 (Refined):** 用户期望软件**基于CA1.0的“核心故事模型”**，智能提炼出最适合改编为剧本杀游戏的核心案件，并生成游戏的背景故事、胜利条件以及推荐的游戏分幕结构。

- **CA1.2 - 设定游戏角色与核心诡计 (Combined & Refined):**
    - **角色池生成:** 用户期望软件**基于“核心故事模型”**，自动列出所有可供玩家扮演的角色池。
    - **核心诡计设定 (凶手、动机、手法):** 用户期望**基于已选定的游戏主线和角色池**，由系统智能推荐或由用户亲自指定凶手。一旦凶手被确定，系统将围绕此设定，锁定其作案动机、手法和相关时间线，形成一个包含核心诡计的、临时的“**游戏化故事模型**”。此模型是“核心故事模型”的一个分支版本。

- **CA1.3 - 生成差异化角色视图（剧本）(Refined):** 用户期望软件**基于已包含核心诡计的“游戏化故事模型”**，为每一个被选定的游戏角色生成其独立的第一人称视角剧本。该剧本**必须**包含：
    1.  角色所知的**部分真相**（如公开信息、背景故事）。
    2.  角色的**个人秘密与隐藏任务**。
    3.  为非凶手角色植入合理的**“嫌疑点”**与**“伪时间线”**（Alibi）。
    4.  为凶手角色生成其**必须掩盖的真实行为**及相应的辩解思路。

- **CA1.4 - 生成指向性线索集 (Refined):** 用户期望软件**基于“游戏化故事模型”**，生成一系列线索卡。所有线索都必须是该模型的“投影”，一部分指向真相，另一部分用于混淆视听，但**绝不能与“核心故事模型”的根本事实相矛盾**。

### CA2: 输入与输出 (Input & Output)

- **CA2.1 - 灵活的输入源 (Retained):** 用户期望支持多样化的小说文本输入方式，包括但不限于：直接在文本框中复制粘贴、上传本地文件（.txt, .pdf, .epub等格式）、或通过提供网络小说的URL链接进行内容获取。

- **CA2.2 - 结构化、可移植的输出包 (Refined):** 用户期望能够导出/下载一个**逻辑结构清晰**的完整游戏包。该包应包含以下**逻辑组件**，其具体文件格式（如PDF, Markdown, JSON）应是可配置选项，而非固定格式：
    -   `主持人手册`: 包含游戏设置全景视图（完整真相、时间线、流程控制、FAQ）。
    -   `玩家资料包`: 按角色区分，每个角色一个独立的资料包。
    -   `线索集`: 按轮次或区域组织。
    -   `结局复盘资料`: 用于最终向玩家揭秘。

- **CA2.3 - 数据可移植性 (New):** 用户期望能导出一种中间的、机器可读的格式（如JSON或XML），其中包含了所有结构化的游戏数据（如“核心故事模型”和“游戏化故事模型”）。这使得高级用户或开发者可以基于此进行二次开发或将数据导入到其他平台（如在线虚拟桌面平台VTT）。

### CA3: 交互式与可配置的生成流程 (Interactive & Configurable Generation Flow)

- **CA3.1 - 全局生成参数配置 (Expanded):** 用户期望在任务开始前，可以对生成策略进行全局配置，以注入其创作意图：
    - **核心参数:** 游戏人数、游戏时长（预期）、游戏难度（如：影响线索隐晦程度、伪证复杂度）。
    - **风格参数 (New):**
        -   **改编忠实度:** 可选“忠于原著”或“魔改增趣”。
        -   **情感基调:** 可选“恐怖悬疑”、“欢乐撕逼”或“情感沉浸”。
    - **结构参数 (New):**
        -   **搜证轮次:** 可指定游戏分为几轮搜证。
        -   **凶手保护机制:** 可选是否为凶手提供额外的保护性规则或线索。

- **CA3.2 - 分步确认与调整的流水线 (Refined):** 用户强烈期望软件提供一个清晰的、可回溯的引导式流程。每一步都是对数据的一次转换，用户可以审查中间结果并注入自己的决策。
    - **步骤1: 故事理解与角色池确认。** 系统展示从小说中提取的“核心故事模型”摘要和关键人物列表。用户在此步骤**确认并勾选**本局游戏要使用的角色。
    - **步骤2: 核心诡计设定。** 系统基于用户选择的角色，推荐凶手候选人。用户在此步骤**最终确定**凶手。
        - **重要提示:** 系统应明确告知用户：“**此步为关键决策点。修改此项将导致后续所有已生成内容（剧本、线索）被废弃并重新计算。**”
    - **步骤3: 初稿生成与审查。** 系统根据前两步的输入，生成所有物料（剧本、线索等）的初稿。
    - **步骤4: 精修与润色。** 用户在一个集成的编辑环境中，对AI生成的所有文本进行**最终的修改和锁定**。系统可在此环节提供逻辑校验辅助，以防止用户的修改破坏核心逻辑。

### CA4: 质量与体验 (Quality & Experience)

- **CA4.1 - 逻辑严谨性 (最高优先级):** 此为产品的核心价值与不可妥协的底线。用户要求生成的剧本杀必须在逻辑上形成**完美闭环**。所有线索、动机、行为和时间线必须自洽。**系统的任何自动生成或辅助修改功能，都不得违背在CA1.0中建立的“核心故事模型”的内在逻辑。**
- **CA4.2 - 风格一致性:** 用户期望AI生成的所有文本内容，能够在语言风格和情感氛围上，与输入的原著小说保持高度一致。此项质量受**CA3.1中的“情感基调”参数**影响。
- **CA4.3 - 创造性与趣味性:** 用户期望软件不仅是原文的忠实改编者，还能在尊重原著设定的基础上，发挥创造力，为游戏增加额外的互动环节或彩蛋。此项表现受**CA3.1中的“改编忠实度”参数**影响。
- **CA4.4 - 处理速度:** 用户期望有良好的性能体验。对于一本中等篇幅的小说（例如20万字），从输入到产出可编辑的初稿，整个过程应在可接受的时间内完成（目标：10分钟以内）。