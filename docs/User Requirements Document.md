好的，指令已收到。

作为一位精通公理设计与函数式编程的专家，我完全理解并赞同评审报告中提出的所有修改意见。这份报告精准地指出了V1.2版本中残留的“耦合”、“信息模糊”和“边界不清”的问题，其建议是通往一个真正健壮、灵活和可维护系统设计的必经之路。

我将立即依据这份“卓越级”的审查意见，对《谜探》的用户需求文档进行再次修订。本次修订的目标是：**将公理设计与函数式编程的思想贯彻到每一个需求定义的细节之中，确保所有CA（用户需求）的原子性、正交性与信息完备性。**

以下是修订后的《谜探》用户需求文档 V1.3。

---

# 《谜探》用户需求文档 (User Requirements Document)

- **项目名称:** “谜探”—— 智能悬疑小说剧本杀转换引擎
- **文档版本:** 1.3
- **文档状态:** **已修订**
- **修订日期:** 2024年6月6日

> **V1.3 修订说明:**
> 本版本是基于V1.2的专家评审报告进行的深度修订。核心目标是将公理设计（Axiomatic Design）与函数式编程（Functional Programming）的原则，从宏观框架进一步渗透到微观需求定义中。主要修订内容包括：
> 1.  **需求的进一步正交化**: 将原`CA1.2`拆分为`CA1.2a`（数据提取）和`CA1.2b`（决策配置），消除了职责耦合。
> 2.  **核心概念的精确化**: 引入了“**角色知识模型**”的概念，并用其精确定义了剧本内容的生成逻辑，取代了原先模糊的“伪时间线”表述。
> 3.  **参数作用域的明确化**: 将原`CA3.1`中的“全局参数”分解，并将其与`CA3.2`数据流水线中的具体步骤精确绑定，明确了每个用户决策的影响范围。
> 4.  **交互鲁棒性的增强**: 新增`CA3.3`，明确要求系统具备“**智能状态缓存**”能力，以优化用户在流程中回溯时的体验。
> 5.  **主观需求的具体化**: 将原`CA4.3`中难以衡量的“创造性”需求，转化为两个具体、可开关的功能点（`CA4.3a`和`CA4.3b`）。

## 1. 项目概述

（此部分无修订，内容同V1.2）

### 1.1 项目目标
本项目的核心目标是开发一款基于先进大语言模型（LLM，以Gemini 2.5 Pro为技术核心）的软件工具。该工具旨在实现自动化或半自动化地将用户输入的悬疑小说文本，高效地转换为一套结构完整、逻辑严谨、可直接用于线下或线上游戏的剧本杀游戏包。

### 1.2 目标用户
- **剧本杀创作者/店家:** 希望快速获得新剧本的创作灵感，或将已有的文学IP改编为剧本杀游戏，以降低创作门槛和时间成本。
- **小说爱好者/跑团玩家:** 渴望将自己喜爱的小说作品，通过一种全新的、高互动性的游戏方式进行沉浸式体验。
- **内容创作者:** 需要快速生成剧本杀相关的内容素材（如故事梗概、人物小传、宣传文案等）用于其作品。

## 2. 用户需求清单 (Customer Attributes, CAs)

本章节详细定义了目标用户对产品的核心期望和要求。这些CAs是后续进行功能需求(FRs)分解和系统设计的根本依据。

### CA1: 核心故事模型的生成与转换 (Core Story Model Generation & Transformation)

这是一个有严格顺序依赖的数据转换流程（Data Pipeline），构成了产品的核心能力。每个步骤都是对前一步输出数据的函数式转换。

- **CA1.0 - 构建核心故事模型:** 用户期望软件能将原始小说文本解析为一个结构化的、包含所有关键信息的“**核心故事模型**”（即“**单一真相来源**”）。该模型是所有后续生成内容的唯一、不可变的真相基石，应包含但不限于：完整的人物关系图谱、精确到关键节点的时间线、所有核心事件的序列、关键物品清单及其流转、以及场景地理信息。

- **CA1.1 - 提炼与适配游戏主线:** 用户期望软件**基于CA1.0的“核心故事模型”**，智能提炼出最适合改编为剧本杀游戏的核心案件，并生成游戏的背景故事、胜利条件以及推荐的游戏分幕结构。

- **CA1.2a - 生成可选角色池 (New & Orthogonal):** 用户期望软件**基于“核心故事模型”**，生成一个包含所有潜在可玩角色的详尽列表，并附带其关键属性摘要（如：与核心事件的关联度、主要人际关系等）。**此为一个纯粹的数据提取与呈现操作。**

- **CA1.2b - 配置核心游戏设定 (New & Orthogonal):** 用户期望**在从CA1.2a的角色池中选择了具体角色后**，能够指定凶手。系统将基于此决策，锁定其作案动机、手法和相关时间线，创建一个临时的、包含核心诡计的“**游戏化故事模型**”。**此为一个用户决策驱动的数据增强与配置操作，是“核心故事模型”到“游戏化故事模型”转换的关键步骤。**

- **CA1.3 - 生成基于角色知识模型的差异化剧本 (Revised & Refined):**
    用户期望软件为每一个被选定的游戏角色，生成其独立的剧本。该剧本的生成必须遵循以下逻辑：
    1.  **引入“角色知识模型”**: 每个角色的剧本内容，都来源于其专属的“**角色知识模型**”。该模型是“游戏化故事模型”针对特定角色的一个**有损、带偏见的投影（Projection）**。
    2.  **生成个人视角陈述**: 基于“角色知识模型”，生成角色的第一人称剧本。该剧本必须包含：
        -   **公开信息与部分真相**: 角色确实知道的事件和背景。
        -   **认知空白**: 因角色不在场或信息被屏蔽而造成的知识盲区。
        -   **刻意隐瞒或不实陈述（谎言）**: 为隐藏个人秘密（不一定与主案件相关）而对某些事件进行的扭曲或隐瞒性描述。**所有谎言都必须有迹可循，并能通过线索(CA1.4)被挑战或推翻。**
        -   对于凶手角色，其剧本必须包含用于掩盖真相的、逻辑自洽的辩解和行动路线。

- **CA1.4 - 生成指向性线索集:** 用户期望软件**基于“游戏化故事模型”**，生成一系列线索卡。所有线索都必须是该模型的“投影”，一部分指向真相，另一部分用于混淆视听，但**绝不能与“核心故事模型”的根本事实相矛盾**。

### CA2: 输入与输出 (Input & Output)

（此部分无修订，内容同V1.2）

- **CA2.1 - 灵活的输入源:** 用户期望支持多样化的小说文本输入方式，包括但不限于：直接在文本框中复制粘贴、上传本地文件（.txt, .pdf, .epub等格式）、或通过提供网络小说的URL链接进行内容获取。

- **CA2.2 - 结构化、可移植的输出包:** 用户期望能够导出/下载一个**逻辑结构清晰**的完整游戏包。该包应包含以下**逻辑组件**，其具体文件格式（如PDF, Markdown, JSON）应是可配置选项，而非固定格式：
    -   `主持人手册`: 包含游戏设置全景视图（完整真相、时间线、流程控制、FAQ）。
    -   `玩家资料包`: 按角色区分，每个角色一个独立的资料包。
    -   `线索集`: 按轮次或区域组织。
    -   `结局复盘资料`: 用于最终向玩家揭秘。

- **CA2.3 - 数据可移植性:** 用户期望能导出一种中间的、机器可读的格式（如JSON或XML），其中包含了所有结构化的游戏数据（如“核心故事模型”和“游戏化故事模型”）。这使得高级用户或开发者可以基于此进行二次开发或将数据导入到其他平台。

### CA3: 交互式与可配置的生成流程 (Interactive & Configurable Generation Flow)

- **CA3.1 - 生成流程的可配置性 (Refined):** 用户期望在数据转换流水线的不同阶段，可以注入其创作意图。这些配置项不再是“全局”的，而是与特定转换步骤相关联（详见CA3.2）。

- **CA3.2 - 带参数注入与回溯的分步引导式流水线 (Revised & Refined):** 用户强烈期望软件提供一个清晰的、可回溯的引导式流程。用户在每一步审查中间结果，并输入参数以指导下一步的转换。
    - **步骤1: 故事理解与主线确认。** 系统展示“核心故事模型”摘要和推荐的游戏主线(CA1.1)。
        -   **用户输入/配置:** 在此步骤，用户可以设定影响全局提炼的**“改编忠实度”**和**“情感基调”**参数。用户最终确认本局游戏要改编的核心案件。
    - **步骤2: 游戏角色与核心诡计设定。** 系统展示可选角色池(CA1.2a)。
        -   **用户输入/配置:** 用户首先输入**“游戏人数”**作为约束条件，然后从角色池中勾选参演角色。随后，用户**最终确定**凶手(CA1.2b)。
        -   **重要提示:** 系统应明确告知用户：“**此步为关键决策点。修改此项将导致后续所有已生成内容被废弃并重新计算。**”（但见CA3.3）
    - **步骤3: 剧本与线索生成。** 系统根据前序所有决策，生成所有物料（剧本、线索等）的初稿。
        -   **用户输入/配置:** 在此步骤开始前，用户可以设定**“游戏难度”**、**“搜证轮次”**以及是否开启**“凶手保护机制”**。这些参数将作为约束，指导线索(CA1.4)和剧本(CA1.3)中嫌疑点的分布与隐晦程度。
    - **步骤4: 精修与润色。** 用户在一个集成的编辑环境中，对AI生成的所有文本进行**最终的修改和锁定**。系统可在此环节提供逻辑校验辅助，以防止用户的修改破坏核心逻辑。

- **CA3.3 - 智能状态管理与缓存 (New):** 用户期望系统具备**智能状态缓存**能力，以提升回溯操作的体验。当用户回溯到上游步骤（如在步骤2修改凶手）并重新生成内容后，系统应**尝试保留**下游步骤（步骤4）中用户已做的、且与上游修改不冲突的手动编辑内容。这类似于**记忆化（Memoization）**思想，例如，一个角色无关紧要的背景故事润色，不应因凶手改变而被清除。

### CA4: 质量与体验 (Quality & Experience)

- **CA4.1 - 逻辑严谨性 (最高优先级):** 此为产品的核心价值与不可妥协的底线。用户要求生成的剧本杀必须在逻辑上形成**完美闭环**。所有线索、动机、行为和时间线必须自洽。**系统的任何自动生成或辅助修改功能，都不得违背在CA1.0中建立的“核心故事模型”的内在逻辑。**
- **CA4.2 - 风格一致性:** 用户期望AI生成的所有文本内容，能够在语言风格和情感氛围上，与输入的原著小说保持高度一致。此项质量受**CA3.2中“情感基调”参数**影响。

- **CA4.3a - 可选互动模块生成 (New & Concrete):** 用户期望系统能够根据“核心故事模型”中的人物关系，智能生成可选的、非主线的“**互动任务模块**”。（例如：A与B有旧怨，系统可自动生成一个关于他们旧怨的、可在游戏环节中触发的专属破冰或对峙任务）。

- **CA4.3b - 自动化彩蛋注入 (New & Concrete):** 用户期望可以开启“彩蛋模式”。开启后，系统会自动在剧本或线索中，植入与原著小说其他情节相关的、不影响主线推理的趣味信息，以提升原著爱好者的体验。

- **CA4.4 - 处理速度:** 用户期望有良好的性能体验。对于一本中等篇幅的小说（例如20万字），从输入到产出可编辑的初稿，整个过程应在可接受的时间内完成（目标：10分钟以内）。